includeConfig "config/utils.config"

params {
  accessions     = ""                       // CSV of accessions to download
  barcodes       = "data/barcodes.csv"      // CSV listing barcode files
  star_indices   = "data/star_indices.csv"  // CSV listing STAR indices
  output_dir     = "results"                // Output directory location
  max_samples    = 5                        // Max number of samples to process, if no accessions are provided
  max_accessions = 5                        // Max number of accessions per sample to use for STAR parameter determination
  max_spots      = 1000000                  // Max number of spots (read-pairs) for STAR param assessment
  min_read_len   = 28                       // Minimum read length for R1 & R2 (shorter read files will be ignored)
  max_sra_size   = 300                      // Max SRA file size in GB (determined via sra-stat); all larger will be filtered
  define         = false                    // Just define the STAR parameters for each sample
  db_host        = "35.243.133.29"          // scRecounter database host
  db_name        = "sragent-prod"           // scRecounter database name
  db_username    = "postgres"               // scRecounter database username
}


//-- Extra configs --//
includeConfig "config/process.config"
includeConfig "config/profiles.config"

//-- Functions --//
// Remove trailing forward slashes in a string
def fmtPath(path_str) {
    return path_str.replaceAll(/\/+$/, '')
}

// Limit to the max resources of the available machine
def check_max(obj, type){
    if(type == 'memory'){
        if(obj.compareTo(params.max_memory as nextflow.util.MemoryUnit) == 1){
            return params.max_memory as nextflow.util.MemoryUnit
        }
    } else if(type == 'time'){
        if (obj.compareTo(params.max_time as nextflow.util.Duration) == 1){
            return params.max_time as nextflow.util.Duration
        }
    } else if(type == 'cpus'){
        if (obj > params.max_cpus as int){
            return params.max_cpus as int
        }
    }
    return obj
}

